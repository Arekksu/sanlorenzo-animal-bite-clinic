<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>San Lorenzo Animal Bite Center - Employee Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='employee-styles.css') }}">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <img src="{{ url_for('static', filename='images/san lorenzo.jpg') }}" alt="Clinic Logo" class="sidebar-logo">
        <h3>San Lorenzo Animal Bite Center</h3>
      </div>
      <ul class="sidebar-menu">
        <li><button class="menu-btn active" onclick="showSection('dashboard')">Dashboard</button></li>
        <li><button class="menu-btn" onclick="showSection('add-record')">Add Record</button></li>
        <li><button class="menu-btn" onclick="showSection('view-patient')">View Patient</button></li>
        <li><button class="menu-btn" onclick="showSection('view-schedule')">View Schedule</button></li>
      </ul>
      <div class="sidebar-bottom">
        <a href="/backup-csv" class="menu-btn sidebar-bottom-btn">‚¨á Backup Patients (CSV)</a>
        <div class="sidebar-bottom-actions">
          <a href="{{ url_for('home') }}" class="menu-btn sidebar-bottom-btn">Logout</a>
          <button class="menu-btn sidebar-bottom-btn" onclick="showSection('settings')">Settings</button>
        </div>
      </div>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard -->
      <section id="dashboard" class="content-section active">
        <h2>Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üë§</div>
            <h3>Total Patients</h3>
            <div class="stat-number">{{ patients|length }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìÖ</div>
            <h3>Upcoming Appointments</h3>
            <div class="stat-number">{{ upcoming_appointments[0]['count'] if upcoming_appointments else 0 }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìÖ</div>
            <h3>Patients Today</h3>
            <div class="stat-number">{{ patients_today[0]['count'] if patients_today else 0 }}</div>
          </div>
        </div>
      </section>

      <!-- Add Record -->
      <section id="add-record" class="content-section">
        <form method="POST" action="{{ url_for('employee_dashboard') }}">
          <!-- Form Tabs -->
          <div class="form-header">
            <div class="form-tabs">
              <button
                type="button"
                class="tab-btn active"
                onclick="showTab('personal-info')"
              >
                Personal Information
              </button>
              <button
                type="button"
                class="tab-btn"
                onclick="showTab('vaccine-bite-info')"
              >
                Vaccine and Bite Information
              </button>
              <button
                type="button"
                class="tab-btn"
                onclick="showTab('schedule')"
              >
                Schedule
              </button>
              </div>
            </div>

          <!-- Personal Info -->
          <div id="personal-info" class="tab-content active">
            <div class="form-grid">
              <div class="form-group">
                <label>Patient Name:</label>
                <input type="text" name="patient_name" required>
              </div>
              <div class="form-group">
                <label>Age:</label>
                <input type="number" name="age" required>
              </div>
              <div class="form-group">
                <label>Gender:</label>
                <select name="gender" required>
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="form-group">
                <label>Contact Number:</label>
                <input type="tel" name="contact_number" required>
              </div>
              <div class="form-group full-width">
                <label>Address:</label>
                <textarea name="address" rows="3" required></textarea>
              </div>
            </div>
          </div>

          <!-- Vaccine & Bite Info -->
          <div id="vaccine-bite-info" class="tab-content">
            <div class="form-grid">
              <div class="form-group">
                <label>Service Type:</label>
                <select name="service_type" required>
                  <option value="Booster">Booster</option>
                  <option value="Pre-Exposure Prophylaxis">Pre-Exposure Prophylaxis</option>
                  <option value="Post-Exposure Prophylaxis">Post-Exposure Prophylaxis</option>
                </select>
              </div>
              <div class="form-group">
                <label>Date of Bite:</label>
                <input type="date" name="date_of_bite">
              </div>
              <div class="form-group">
                <label>Bite Location:</label>
                <input type="text" name="bite_location">
              </div>
              <div class="form-group">
                <label>Place of Bite:</label>
                <input type="text" name="place_of_bite">
              </div>
              <div class="form-group">
                <label>Type of Bite:</label>
                <select name="type_of_bite">
                  <option value="One Bite">One Bite</option>
                  <option value="Multiple Bites">Multiple Bites</option>
                  <option value="Scratch">Scratch</option>
                </select>
              </div>
              <div class="form-group">
                <label>Source of Bite:</label>
                <select name="source_of_bite">
                  <option value="Cat">Cat</option>
                  <option value="Dog">Dog</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Other Source:</label>
                <input type="text" name="other_source_of_bite">
              </div>
              <div class="form-group">
                <label>Source Status:</label>
                <select name="source_status">
                  <option value="Alive">Alive</option>
                  <option value="Dead">Dead</option>
                </select>
              </div>
              <div class="form-group">
                <label>Exposure:</label>
                <select name="exposure">
                  <option value="Neighbor">Neighbor</option>
                  <option value="Stranger">Stranger</option>
                  <option value="Family">Family</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Vaccinated:</label>
                <label><input type="radio" name="vaccinated" value="Yes" checked> Yes</label>
                <label><input type="radio" name="vaccinated" value="No"> No</label>
              </div>
            </div>
          </div>

            <!-- Schedule -->
            <div id="schedule" class="tab-content schedule-section">
              <div class="schedule-grid">
                <div class="schedule-item">
                  <label>Day 0:</label>
                  <input type="date" name="day0" />
                </div>
                <div class="schedule-item">
                  <label>Day 3:</label>
                  <input type="date" name="day3" />
                </div>
                <div class="schedule-item">
                  <label>Day 7:</label>
                  <input type="date" name="day7" />
                </div>
                <div class="schedule-item">
                  <label>Day 14:</label>
                  <input type="date" name="day14" />
                </div>
                <div class="schedule-item">
                  <label>Day 28:</label>
                  <input type="date" name="day28" />
                </div>
              </div>
            </div>

          <!-- Actions -->
          <div class="form-actions">
            <button type="submit" class="btn-success">Save Record</button>
          </div>
        </form>
      </section>

      <!-- View Patient -->
      <section id="view-patient" class="content-section">
        <h2>Patient Records</h2>
        <div class="table-container">
          <table class="patient-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Patient Name</th>
                <th>Date of Bite</th>
                <th>Service</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for p in patients %}
              <tr>
                <td>{{ p['id'] }}</td>
                <td>{{ p['patient_name'] }}</td>
                <td>{{ p['date_of_bite']  }}</td>
                <td>{{ p['service_type'] }}</td>
                <td class="action-buttons">
                  <button class="btn-view" data-patient-id="{{ p['id'] }}" title="View Details">
                    <img src="{{ url_for('static', filename='images/icons/istockphoto-845329690-612x612-removebg-preview.png') }}" alt="View" class="action-icon">
                  </button>
                  <button class="btn-edit" data-patient-id="{{ p['id'] }}" title="Edit Patient">
                    <img src="{{ url_for('static', filename='images/icons/3512833-removebg-preview.png') }}" alt="Edit" class="action-icon">
                  </button>
                  <button class="btn-delete" data-patient-id="{{ p['id'] }}" title="Delete Patient">
                    <img src="{{ url_for('static', filename='images/icons/images-removebg-preview.png') }}" alt="Delete" class="action-icon">
                  </button>
                </td>
              </tr>
              {% else %}
              <tr><td colspan="5">No patients found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- View Schedule -->
      <section id="view-schedule" class="content-section">
        <h2>Schedule Calendar</h2>
        <!-- Calendar Header (ADDED) -->
        <div class="calendar-header">
          <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
          <div id="calendar-month-year" style="font-weight:600;"></div>
          <button class="calendar-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
        </div>
        <!-- Calendar Stats -->
        <div class="calendar-stats">
          <div class="stat-card">
            <h3>Today's Patients</h3>
            <div class="stat-number">{{ patients_today[0]['count'] if patients_today else 0 }}</div>
          </div>
          <!-- Calendar Grid -->
          <div class="calendar-container">
            <div class="calendar-weekdays">
              <div class="weekday">Sun</div>
              <div class="weekday">Mon</div>
              <div class="weekday">Tue</div>
              <div class="weekday">Wed</div>
              <div class="weekday">Thu</div>
              <div class="weekday">Fri</div>
              <div class="weekday">Sat</div>
            </div>
            <div class="calendar-days" id="calendar-days">
              <!-- Calendar days will be generated by JavaScript -->
            </div>
          </div>

          <!-- Schedule Legend -->
          <div class="schedule-legend">
            <h4>Schedule Legend:</h4>
            <div class="legend-items">
              <div class="legend-item">
                <div class="legend-color day0"></div>
                <span>Day 0 (Initial Dose)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color day3"></div>
                <span>Day 3</span>
              </div>
              <div class="legend-item">
                <div class="legend-color day7"></div>
                <span>Day 7</span>
              </div>
              <div class="legend-item">
                <div class="legend-color day14"></div>
                <span>Day 14</span>
              </div>
              <div class="legend-item">
                <div class="legend-color day28"></div>
                <span>Day 28 (Final)</span>
              </div>
            </div>
          </div>

          <!-- Daily Schedule Details -->
          <div class="daily-schedule" id="daily-schedule">
            <h4>Appointments for <span id="selected-date"></span></h4>
            <div class="appointment-list" id="appointment-list">
              <p>Select a date to view appointments</p>
            </div>
          </div>

          <!-- Appointment Details Modal for Calendar (used by JS) -->
          <div id="appointmentModal" class="modal" style="display:none">
            <div class="modal-content">
              <div class="modal-header">
                <h2>Appointment Details</h2>
                <span class="close" onclick="closeAppointmentModal()">&times;</span>
              </div>
              <div id="appointmentDetailsContent" class="modal-body"></div>
            </div>
          </div>

          <!-- Toast Notification (for appointment actions) -->
          <div id="copilot-toast" style="display:none"></div>

          <!-- Appointment Actions Modal -->
          <div id="appointmentActionsModal" class="modal">
            <div class="modal-content">
              <div class="modal-header">
                <h2>Appointment Actions</h2>
                <span class="close" onclick="closeAppointmentModal()">&times;</span>
              </div>
              <div class="modal-body">
                <div class="appointment-info">
                  <h3 id="modal-appointment-patient"></h3>
                  <p><strong>Date:</strong> <span id="modal-appointment-date"></span></p>
                  <p><strong>Service:</strong> <span id="modal-appointment-service"></span></p>
                  <p><strong>Schedule:</strong> <span id="modal-appointment-schedule"></span></p>
                </div>
                <div class="appointment-actions-grid">
                  <button class="action-btn view-btn" onclick="viewAppointmentDetails()">
                    üëÅÔ∏è View Details
                  </button>
                  <button class="action-btn done-btn" onclick="markAsDone()">
                    ‚úÖ Mark as Done
                  </button>
                  <button class="action-btn noshow-btn" onclick="markAsNoShow()">
                    ‚ùå Mark as No Show
                  </button>
                  <button class="action-btn reschedule-btn" onclick="rescheduleAppointment()">
                    üìÖ Reschedule
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Patient Details Modal -->
    <!-- VIEW PATIENT MODAL (used by JS) -->
    <div id="patientModal" class="modal" style="display:none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Patient Details</h2>
          <span class="close" onclick="closeModal('patientModal')">&times;</span>
        </div>
        <div id="patientModalBody" class="modal-body"></div>
      </div>
    </div>

    <!-- VIEW PATIENT MODAL -->
    <div id="patientModal" class="modal" style="display:none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Patient Details</h2>
          <span class="close" onclick="closeModal('patientModal')">&times;</span>
        </div>
        <div id="patientModalBody" class="modal-body"></div>
      </div>
    </div>

    <!-- EDIT PATIENT MODAL -->
    <div id="editPatientModal" class="modal" style="display:none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Patient</h2>
          <span class="close" onclick="closeModal('editPatientModal')">&times;</span>
        </div>
        <div class="modal-body">
          <form id="editPatientForm" onsubmit="return submitEditPatient(event)">
            <input type="hidden" id="edit_patient_id">

            <div class="form-grid">
              <div class="form-group">
                <label for="edit_patient_name">Patient Name</label>
                <input id="edit_patient_name" type="text" required>
              </div>
              <div class="form-group">
                <label for="edit_date_of_bite">Date of Bite</label>
                <input id="edit_date_of_bite" type="date">
              </div>
              <div class="form-group">
                <label for="edit_service_type">Service</label>
                <input id="edit_service_type" type="text">
              </div>
              <div class="form-group">
                <label for="edit_contact_number">Contact</label>
                <input id="edit_contact_number" type="text">
              </div>
              <div class="form-group">
                <label for="edit_age">Age</label>
                <input id="edit_age" type="number" min="0">
              </div>
              <div class="form-group">
                <label for="edit_gender">Gender</label>
                <select id="edit_gender">
                  <option value=""></option>
                  <option>Male</option>
                  <option>Female</option>
                </select>
              </div>
              <div class="form-group form-group full-width">
                <label for="edit_address">Address</label>
                <input id="edit_address" type="text">
              </div>

              <div class="form-group">
                <label for="edit_bite_location">Bite Location</label>
                <input id="edit_bite_location" type="text">
              </div>
              <div class="form-group">
                <label for="edit_place_of_bite">Place of Bite</label>
                <input id="edit_place_of_bite" type="text">
              </div>
              <div class="form-group">
                <label for="edit_source_of_bite">Source of Bite</label>
                <input id="edit_source_of_bite" type="text">
              </div>
              <div class="form-group">
                <label for="edit_type_of_bite">Type of Bite</label>
                <input id="edit_type_of_bite" type="text">
              </div>
              <div class="form-group">
                <label for="edit_source_status">Source Status</label>
                <input id="edit_source_status" type="text">
              </div>
              <div class="form-group">
                <label for="edit_exposure">Exposure</label>
                <input id="edit_exposure" type="text">
              </div>

              <div class="form-group">
                <label for="edit_day0">Day 0</label>
                <input id="edit_day0" type="date">
              </div>
              <div class="form-group">
                <label for="edit_day3">Day 3</label>
                <input id="edit_day3" type="date">
              </div>
              <div class="form-group">
                <label for="edit_day7">Day 7</label>
                <input id="edit_day7" type="date">
              </div>
              <div class="form-group">
                <label for="edit_day14">Day 14</label>
                <input id="edit_day14" type="date">
              </div>
              <div class="form-group">
                <label for="edit_day28">Day 28</label>
                <input id="edit_day28" type="date">
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="closeModal('editPatientModal')">Cancel</button>
              <button type="submit" class="btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  <script src="{{ url_for('static', filename='employee-script.js') }}"></script>
</body>
</html>
